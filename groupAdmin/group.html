<div class="groupAdmin">
	<div ng-if="loading">
	Chargement...
	</div>
	<div ng-show="error">{{error}}</div>
	<div ng-if="!loading">

		{{group.sName}}

		<uib-tabset active="active">
			<uib-tab heading="Descriptif">
				<div class="groupAdmin-tabContent">
					<div class="row">
						<div class="col-lg-5">
							<div class="row">
								<div class="col-sm-4">
									<label class="control-label">
										<span class="label-title">Nom du groupe</span>
										<span class="label-description">Indiquez le nom que vous souhaitez donner à votre groupe</span>
									</label>
								</div>
								<div class="col-sm-8">
									<input type="text" ng-model="group.sName" class="form-control"/>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-4">
									<label class="control-label">
										<span class="label-title">Type</span>
										<span class="label-description">Sélectionnez le type de groupe</span>
									</label>
								</div>
								<div class="col-sm-8">
									<select ng-model="group.sType" class="form-control">
									<option value="{{key}}" ng-repeat="(key, value) in groupFields.sType.values" ng-selected="group.sType == key" ng-if="key!='Root'">{{value.label}}</option>
									</select>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-4">
									<label class="control-label">
										<span class="label-title">Description</span>
										<span class="label-description">Ce champ est disponible si vous souhaitez ajouter une description à ce groupe</span>
									</label>
								</div>
								<div class="col-sm-8">
									<textarea ng-model="group.sDescription" class="form-control"></textarea>
								</div>
							</div>
							<div ng-if="group.sType == 'Class'" class="row">
								<div class="col-sm-4">
									<label class="control-label" ng-if="group.sType == 'Class'">
										<span class="label-title">Niveau</span>
										<span class="label-description">Indiquez le niveau du groupe</span>
									</label>
								</div>
								<div class="col-sm-8">
									<select ng-model="group.iGrade" class="form-control">
										<option value="{{key}}" ng-repeat="(key, value) in groupFields.iGrade.values" ng-selected="group.iGrade == key">{{value.label}}</option>
									</select>
									<input type="text" ng-if="group.iGrade == '-4'" ng-model="group.sGradeDetails" class="form-control" placeholder="Précisez"/>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-12">
									<a class="btn btn-primary pull-right" ng-click="saveObject('groups', group)" ng-disabled="!hasObjectChanged('groups', group)">Enregistrer</a>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-12 block-delete">
									<a class="group-delete" ng-click="removeGroup()">Supprimer le groupe</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</uib-tab>

			<uib-tab heading="Membres">
				<div class="groupAdmin-tabContent">
					<div class="row">
						<div class="col-sm-4">
							<div class="groupAdmin-title">Composition du groupe «{{group.sName}}»</div>
							<ul class="list list-block list-users">
								<li class="list-item" ng-repeat="child in group.children | directOrInvitation">
									<span class="user-status connected"></span>
									<span class="user-name">{{child.child.userSelf[0].sFirstName}} {{child.child.userSelf[0].sLastName}} ({{child.child.userSelf[0].sLogin}})</span>
									<span class="action">
										<button class="btn-icon btn-view-more btn-small" title="voir"><span class="btn-label">voir</span></button>
										<button class="btn-icon btn-delete btn-small" ng-clic="removeUser(child);" title="supprimer"><span class="btn-label">supprimer</span></button>
									</span>
								</li>
							</ul>
						</div>
						<div class="col-sm-8">
							<div class="groupAdmin-title">Gestion des inscriptions
							<span>Utilisez l'une ou plusieurs des méthodes suivantes :</span></div>
							<div class="row">
								<div class="col-sm-6">
									<div class="label-title label-list-item">Ajout d'utilisateurs</div>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<input type="text" class="form-control" id="sLogin" ng-model="formValues.currentLogins" placeholder="Insérez les logins séparés par des espaces">
								</div>
								<div class="col-sm-6">
									<button class="btn-icon btn-add" ng-click="inviteLogins()"><span class="btn-label">ajouter logins</span></button>
								</div>
							</div>
							<span ng-bind="invitationError"></span>

							<!--<field model="group" field="groups.bFreeAccess" />-->
							<div class="row">
								<div class="col-sm-6">
									<div class="label-title label-list-item">Code d'inscription :</div>
									<p>Ouvrir l'accès au groupe moyennant un code d'inscription</p>
								</div>
								<div class="col-sm-6">
									<div class="checkboxSwitch">
										<input type="checkbox" id="codeInscr" class="switch" ng-model="formValues.hasPassword" ng-change="passwordCheck();">
										<label for="codeInscr"><span></span></label>
									</div>
								</div>
							</div>
							<div class="row" ng-if="formValues.hasPassword">
								<div class="col-sm-6">
									<p>Code d'inscription à transmettre aux élèves</p>
								</div>
								<div class="col-sm-6 form-inline">
									<input type="text" class="form-control" ng-model="group.sPassword" />
									<button ng-click="refreshPassword()" class="btn btn-primary">Renouveler le code</button>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-6">
									<div class="label-title label-list-item">Demandes d'adhésion spontanées</div>
									<p>Autoriser les demandes spontanées</p>
								</div>
								<div class="col-sm-6">
									<div class="checkboxSwitch">
										<input type="checkbox" id="demSpont" class="switch" ng-model="group.bOpened">
										<label for="demSpont"><span></span></label>
									</div>
								</div>
							</div>
							<div  ng-if="group.bOpened" class="row">
								<div class="col-lg-6 col-lg-offset-6">
									<div ng-if="!showRequestTable()">
										<p>(aucune)</p>
									</div>
									<div ng-if="showRequestTable()">
										<ul class="list list-block list-applicants">
												<li class="list-item" ng-repeat="child in group.children | byRequest" class="{success: invitation.success}">
													<span class="user-name">{{child.child.userSelf[0].sFirstName}} {{child.child.userSelf[0].sLastName}} ({{child.child.userSelf[0].sLogin}})</span>
													<span class="action"><button class="btn-icon btn-small btn-wide" ng-click="acceptRequest(child);"><i class="glyphicon glyphicon-ok" title="Accepter"></i></button><button class="btn-icon btn-small btn-wide" ng-click="refuseRequest(child);"><i class="glyphicon glyphicon-remove" title="Refuser"></i></button></span>
												</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<a class="btn btn-primary pull-right">Enregistrer</a>
						</div>
					</div>
				</div>
			</uib-tab>

			<uib-tab heading="Progression du groupe">
				<div class="groupAdmin-tabContent">
					<div class="row">
						<div class="col-sm-6">
							<span class="pull-left">Sélectionnez le type de progression : </span>
							<div class="block-context">
								<label><input type="radio" ng-model="progressionType" value="chronological">Chronologique, élève par élève</label><br>
								<label><input type="radio" ng-model="progressionType" value="collective">Suivant l'ordre du parcours, vue collective</label>
							</div>
						</div>
						<div ng-if="progressionType == 'collective'" class="col-sm-6">
							<ul class="legend">
								<li><span class="legend-color green"></span><span class="legend-label">Exercice validé</span></li>
								<li><span class="legend-color red"></span><span class="legend-label">Exercice non réussi</span></li>
								<li><span class="legend-color orange"></span><span class="legend-label">Exercice validé malgré un scrore partiel</span></li>
								<li><span class="legend-color dark-grey"></span><span class="legend-label">Exercice lu, sans essai</span></li>
								<li><span class="legend-color light-grey"></span><span class="legend-label">Exercice jamais lu</span></li>
							</ul>
						</div>
					</div>

					<div ng-if="progressionType != 'collective'" class="row">
						<div class="col-sm-4">
							<div class="groupAdmin-title">Utilisateur <span>Cliquez sur un utilisateur pour obtenir le détail de son activité récente ou pour le déselectionner et voir l'activité récente du groupe dans son ensemble.</span></div>
							<ul class="list list-block list-users">
							<!-- TODO : add class toggle when selected -->
									<li class="list-item seleted" ng-repeat="child in group.children | confirmed">
										<span class="user-status connected"></span>
										<span class="user-name">{{child.child.userSelf[0].sFirstName}} {{child.child.userSelf[0].sLastName}}</span>
									</li>
							</ul>
						</div>
						<div class="col-sm-8">
							<div class="groupAdmin-title">Activité récente</div>
							<!-- TODO : class for each activity type -->
							<table class="table table-activity">
								<thead>
									<tr>
										<th>Utilisateur</th>
										<th>Date</th>
										<th>Type</th>
										<th>Parcours, Chapitre, Exercice</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>Prénom nom (login)</td>
										<td>3/3/2016 18:30</td>
										<td class="activity-type attempt">3e tentative de résolution<button class="btn-icon btn-modal"><span class="btn-label">Voir plus</span></button></td>
										<td>Création</td>
									</tr>
									<tr>
										<td>Prénom nom (login)</td>
										<td>3/3/2016 18:15</td>
										<td class="activity-type validation">valiation d'exercice<button class="btn-icon btn-modal"><span class="btn-label">Voir plus</span></button></td>
										<td>Création</td>
									</tr>
									<tr>
										<td>Prénom nom (login)</td>
										<td>3/3/2016 18:00</td>
										<td class="activity-type question">Question sur le forum<button class="btn-icon btn-modal"><span class="btn-label">Voir plus</span></button></td>
										<td>Titre vraiment très très très long</td>
									</tr>
									<tr>
										<td>Prénom nom (login)</td>
										<td>3/3/2016 17:55</td>
										<td class="activity-type validation">Validation de chapitre<button class="btn-icon btn-modal"><span class="btn-label">Voir plus</span></button></td>
										<td>Création</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>

					<div ng-if="progressionType == 'collective'">
						<div class="row">
							<div class="col-sm-6">
								Parcours :
								<select><option>Bob &amp; Max</option></select>
								Niveau :
								<select><option>Le premier niveau</option></select>
							</div>
							<div class="view-switcher col-sm-6">
								<!-- TODO: on button click, switch between global / detailed view
									* toggle button class .btn-zoom-in / .btn-zoom-out
									* toggle table.table-progress class (.progress-global / .progress-detail)
									* display td.status content according to global / detailed view
							  -->
								<span class="pull-right">Afficher la vue globale <button class="btn-icon btn-zoom-out"></button></span>
							</div>
						</div>
						<table class="table-progress progress-global">
							<thead>
								<tr>
									<th class="fixed-width">Nom du chapitre / étape</th>
									<th class="fixed-width">Description</th>
									<th ng-repeat="child in group.children | confirmed" class="text-center name"><div><span>{{child.child.userSelf[0].sFirstName}} {{child.child.userSelf[0].sLastName}} ({{child.child.userSelf[0].sLogin}})</span></div></th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="item in itemsList">
									<td class="fixed-width">{{item.strings[0].sTitle}}</td>
									<td class="fixed-width description">
										<div>{{item.strings[0].sDescription}} Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div></td>
									<td ng-repeat="child in group.children | confirmed" class="status validation">
									<!-- if view progress detail
										<ul ng-init="thisUserItem = getUserItem(child, item);" class="list-progress-details">
												<li class="date">03/03 17:30</li>
												<li class="time">00'30"</li>
												<li class="help">0</li><span class="break"></span>
												<li class="score">{{thisUserItem.iScore}}/100</li>
												<li class="submissions">{{thisUserItem.nbSubmissionsAttempts}} essai(s)<button class="btn-icon btn-modal" ng-click="openPopup(child,item);" title="voir le code"><span class="btn-label">Voir plus</span></button></li>
												<li class="questions">{{thisUserItem.nbHintsCached}}</li>
										</ul>
									-->
									<!-- endif -->

									<!-- if view progress global -->
										<!-- TODO: btn-preview toggle class .visible on ul.list-progress-details -->
										<button class="btn-icon btn-small btn-preview pull-left" title="aperçu"></button>
										<button class="btn-icon btn-small btn-modal pull-right" ng-click="openPopup(child,item);" title="voir le code"><span class="btn-label">Voir plus</span></button>
										<ul ng-init="thisUserItem = getUserItem(child, item);" class="list-progress-details">
												<li class="score">{{thisUserItem.iScore}}/100</li>
												<li class="date">03/03 17:30</li>
												<li class="time">00'30"</li>
												<li class="submissions">{{thisUserItem.nbSubmissionsAttempts}} essai(s)</li>
												<li class="questions">{{thisUserItem.nbHintsCached}}</li>
												<li class="help">0</li>
										</ul>
									<!-- endif -->
									</td>
								</tr>
							</tbody>
						</table>

					</div>
				</div>
			</uib-tab>

			<uib-tab heading="Administration">
				Administrateurs du groupe {{group.sName}} :

				<table class="table table-bordered table-hover">
					<thead>
						<tr>
							<th>Utilisateur</th>
							<th>Administrateur</th>
							<th>Observateur</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="parent in group.parents">
							<td>{{parent.parent.userOwned[0].sFirstName}} {{parent.parent.userOwned[0].sLastName}} ({{child.child.userSelf[0].sLogin}})</td>
							<td><input type="radio" ng-model="parent.sRole" ng-change="changeAdminRole(parent, 'manager');"></td>
							<td><input type="radio" ng-model="parent.sRole" ng-change="changeAdminRole(parent, 'observer');"></td>
							<td><button ng-click="removeAdmin(parent);">poubelle</button></td>
						</tr>
					</tbody>
				</table>

				<div class="form-group">
					<label for="sLogin">Logins à ajouter (séparer par des espaces) :</label>
					<input type="text" class="form-control" id="adminLogins" ng-model="formValues.adminLogins">
				</div>
				<button class="btn btn-primary" ng-click="inviteAdminLogins();">ajouter logins</button>
				<span ng-bind="invitationError"></span>
			</uib-tab>
		</uib-tabset>

	</div>
</div>